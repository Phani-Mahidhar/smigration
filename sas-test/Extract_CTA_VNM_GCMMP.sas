%LET CTRY = %SYSGET(CTRY);
%LET ST_SRC_LAND = %SYSGET(ST_SRC_LAND);
%LET ST_CNTY_STAGING = %SYSGET(ST_CNTY_STAGING);
%LET G9STRAT_BASE    = %SYSGET(G9STRAT_BASE);
%LET RUNDATE = %SYSGET(RUNDATE);
 
%put &RUNDATE;
 
 
data _null_;
  call symput('RUNDATEP',put(input("&rundate",yymmdd8.)-1,yymmddn8.));
run;
 
data _null_;
  call symput('RUNDATEN',put(input("&rundate",yymmdd8.)+1,yymmddn8.));
run;
 
%let exists_src = %sysfunc(fileexist("&ST_SRC_LAND./gcwmp_&RUNDATE..dat"));
%put &exists_src.;
 
libname stgp "&ST_CNTY_STAGING./&RUNDATEP.";
libname stg "&ST_CNTY_STAGING./&RUNDATE.";
libname stgn "&ST_CNTY_STAGING./&RUNDATEN.";
libname &ctry._ANA "/sasdata/hsbc/dil/.COLL/.G9/PROD/&CTRY./Collections/Analytics/sensitive/detailmart/&RUNDATEN.";
libname c9mart "/sasdata/hsbc/dil/.COLL/.G9Strategic/PROD/&CTRY./Collections/c9marts/&RUNDATEN.";
 
%macro extract_src;
 
%if &exists_src. = 1 %then %do;
%put *******extracting file...*******;
 
libname  stg  "&ST_CNTY_STAGING./&RUNDATE";
 
data stgn.GCMMP;
infile "&ST_SRC_LAND./gcwmp_&RUNDATE..dat" dlm='|' dsd missover ls=7370;
 
input
@1     APPLICATION     :2.
@4     ORGANIZATION    :3.
@8     ACCOUNT_NBR     :$19.
@28    LOGO    :3.
@32    COLL_ORG        :3.
@36    CUSTOMER_NBR    :$24.
@61    CUST_NAME       :$45.
@107   CUST_FIRST_NAME :$25.
@133   CUST_MDDLE_NAME :$25.
@159   CUST_LAST_NAME  :$35.
@195   CUST_MAT_NAME   :$35.
@231   CUST_PREFIX     :$4.
@236   CUST_SUFFIX     :$4.
@241   CUST_ADD_LINE_1 :$40.
@282   CUST_ADD_LINE_2 :$40.
@323   CUST_ADD_LINE_3 :$40.
@364   CUST_ADD_LINE_4 :$40.
@405   CUST_CITY       :$30.
@436   CUST_STATE      :$2.
@439   CUST_POST_CODE  :$9.
@449   CUST_COUNTY     :$30.
@480   CUST_ISO_COUNTRY_CODE   :$2.
@483   CUST_EMAIL      :$48.
@532   CUST_PRI_LANG_IND       :$2.
@535   CUST_SSN        :$9.
@545   CUST_DOB        :7.
@553   CUST_PRI_REL    :$1.
@555   CUST_PRI_ADDR_TYPE      :1.
@557   CUST_SEC_NAME   :$45.
@603   CUST_PRI_BUS_NAME       :$45.
@649   CUST_PRI_BUS_REL        :$1.
@651   CUST_PRI_BUS_ADD_TYPE   :1.
@653   CUST_BUS_ADD_LINE_1     :$35.
@689   CUST_BUS_ADD_LINE_2     :$35.
@725   CUST_BUS_ADD_LINE_3     :$35.
@761   CUST_BUS_CITY   :$30.
@792   CUST_BUS_STATE  :$2.
@795   CUST_BUS_POST_CODE      :$9.
@805   CUST_BUS_COUNTY :$30.
@836   CUST_BUS_ISO_CNTY_CDE   :$2.
@839   CUST_BUS_EMAIL  :$48.
@888   CUST_BUS_LANG_IND       :$2.
@891   PH_TYPE_1       :$1.
@893   PH_AVAIL_CDE_1  :$1.
@895   PH_AREA_CODE_1  :$3.
@899   PH_PREFIX_1     :$3.
@903   PH_SUFFIX_1     :$4.
@908   PH_EXT_1        :$10.
@919   PH_TYPE_2       :$1.
@921   PH_AVAIL_CDE_2  :$1.
@923   PH_AREA_CODE_2  :$3.
@927   PH_PREFIX_2     :$3.
@931   PH_SUFFIX_2     :$4.
@936   PH_EXT_2        :$10.
@947   PH_TYPE_3       :$1.
@949   PH_AVAIL_CDE_3  :$1.
@951   PH_AREA_CODE_3  :$3.
@955   PH_PREFIX_3     :$3.
@959   PH_SUFFIX_3     :$4.
@964   PH_EXT_3        :$10.
@975   PH_TYPE_4       :$1.
@977   PH_AVAIL_CDE_4  :$1.
@979   PH_AREA_CODE_4  :$3.
@983   PH_PREFIX_4     :$3.
@987   PH_SUFFIX_4     :$4.
@992   PH_EXT_4        :$10.
@1003  CUST_ID_TYPE    :$1.
@1005  CUST_ID_NBR     :$25.
@1031  CUST_PIB_NBR    :$19.
@1051  AMT_CREDIT_LIMIT        :18.
@1070  AMT_TOT_BAL     :18.
@1089  AMT_OVERLIMIT   :18.
@1108  AMT_DISPUTE     :18.
@1127  AMT_TOT_DUE     :18.
@1146  AMT_CUR_DUE     :18.
@1165  AMT_TOT_DELQ    :18.
@1184  AMT_LAST_PYMT   :18.
@1203  AMT_CHARGE_OFF  :18.
@1222  AMT_LAST_MONETARY       :18.
@1241  AMT_INT_LATE_CHARGE     :18.
@1260  AMT_DELQ_AGE_1  :18.
@1279  AMT_DELQ_AGE_2  :18.
@1298  AMT_DELQ_AGE_3  :18.
@1317  AMT_DELQ_AGE_4  :18.
@1336  AMT_DELQ_AGE_5  :18.
@1355  AMT_DELQ_AGE_6  :18.
@1374  AMT_DELQ_AGE_7  :18.
@1393  AMT_DELQ_AGE_8  :18.
@1412  AMT_COMMTT_FEE  :18.
@1431  AMT_TOT_OD_INT  :18.
@1450  AMT_OVRALL_CRLIM        :18.
@1469  DTE_CREDIT_LIMIT        :7.
@1477  DTE_CARD_EXPIRE :7.
@1485  DTE_CHARGE_OFF  :7.
@1493  DTE_ACCT_OPEN   :7.
@1501  DTE_WARN_BULLETIN       :7.
@1509  DTE_LAST_PYMT   :7.
@1517  DTE_CUST_SINCE  :7.
@1525  DTE_LAST_MONETARY       :7.
@1533  DTE_CR_CHG      :7.
@1541  DTE_SEC_VALUE   :7.
@1549  DTE_OD_SINCE    :7.
@1557  DTE_FCLTY_RVW   :7.
@1565  DTE_COMMITTE    :7.
@1573  AGE_HISTORY     :$12.
@1586  CNT_CYCLES_DELQ :3.
@1590  CYCLE   :2.
@1593  NBR_OF_CARDS    :$2.
@1596  NBR_OF_HUB_ACCTS        :2.
@1599  NBR_DAYS_DLQ    :3.
@1603  WARN_BULLETIN_ZONE      :$4.
@1608  SCORE_CREDIT    :$5.
@1614  SCORE_BEHAV     :$4.
@1619  TYPE_LAST_MONETARY      :$2.
@1622  CODE_VALUE      :$2.
@1625  CODE_RISK       :$2.
@1628  CODE_MRKT_SECTOR        :$5.
@1634  CODE_CO_REASON  :$2.
@1637  CODE_FCLT_CATGY :$3.
@1641  CODE_MORT_INS   :$2.
@1644  CODE_NATIONAL   :$2.
@1647  IND_INT_ONLY    :$1.
@1649  IND_GMIS_USER   :$2.
@1652  IND_OTHR_ADV    :$1.
@1654  IND_TNGBLE_SEC  :$1.
@1656  IND_ISLAMIC_PROD        :$1.
@1658  CODE_GHO_CLASS  :$3.
@1662  IND_CRDT_GRDE   :$1.
@1664  IND_RESTRICTION :$1.
@1666  IND_STATUS_CDE  :$1.
@1668  NBR_INST_OD     :2.
@1671  TRANSFER_ACCT   :$19.
@1691  AMT_BAL_LDGR    :18.
@1710  IND_HLD :$1.
@1712  USER_ACCT_NBR   :$19.
@1732  HUB_EXT_NBR     :$34.
@1767  AMT_REPO_CHARGE :18.
@1786  AMT_PYMT        :18.
@1805  AMT_PRINCIPAL_DELQ      :18.
@1824  AMT_INTEREST_DELQ       :18.
@1843  AMT_PRINCIPAL   :18.
@1862  AMT_ORIG_BALANCE        :18.
@1881  DTE_NEXT_DUE    :7.
@1889  DTE_REPO        :7.
@1897  DTE_MATURITY    :7.
@1905  DTE_REFINANCE   :7.
@1913  DTE_LAST_BILLING        :7.
@1921  DTE_RESCHDLE    :7.
@1929  NBR_OFFICER     :$6.
@1936  NBR_BRANCH      :$6.
@1943  NBR_DEALER      :$6.
@1950  ORIG_TERM       :$4.
@1955  RATE_ORIG_INT   :7.
@1963  RATE_INTEREST   :7.
@1971  RATE_LN_TO_VALUE        :7.
@1979  FREQ_PYMT       :$2.
@1982  IND_DEPOSIT     :$1.
@1984  IND_ON_BUDGET   :$1.
@1986  IND_DPA :$1.
@1988  CODE_CUT_OFF    :$3.
@1992  TYPE_ACCT       :$3.
@1996  TYPE_SERVICE    :$3.
@2000  AMT_BUDGET_PYMT :18.
@2019  AMT_TERMINATION :18.
@2038  DTE_CUT_OFF     :7.
@2046  DTE_TERM_EXPIRE :7.
@2054  NBR_ACLS_BANK   :5.
@2060  CODE_ACLS_APP   :3.
@2064  AMT_EST_MONTH_PYMT      :18.
@2083  IND_ACI :$1.
@2085  SERVICING_SYSTEM        :$8.
@2094  CURR_NATL       :$3.
@2098  CURR_BASE       :$3.
@2102  CURR_PREF       :$3.
@2106  FI_ACTION_IND   :$3.
@2110  FI_LETTER_IND   :$3.
@2114  FI_CONTRL_IND   :$1.
@2116  FI_COLL_STRATEGY_ID     :$3.
@2120  FI_COLL_SCENARIO_ID     :$3.
@2124  FI_SPID :$3.
@2128  FI_RETURNED_COLL_LTR    :$5.
@2134  FI_SPECIL_HNDLNG_IND    :$2.
@2137  FI_COLLECTION_IND       :$3.
@2141  AMT_BAL_AT_RISK :18.
@2160  BLOCK_CODE_1    :$1.
@2162  BLOCK_CODE_2    :$1.
@2164  DTE_BLK_CDE_1   :7.
@2172  DTE_BLK_CDE_2   :7.
@2180  DTE_INTO_COLL   :7.
@2188  REL_BILLING_LVL :$1.
@2190  NBR_MONTHS_OPEN :3.
@2194  AMT_USER_1      :18.
@2213  AMT_USER_2      :18.
@2232  AMT_USER_3      :18.
@2251  AMT_USER_4      :18.
@2270  AMT_USER_5      :18.
@2289  AMT_USER_6      :18.
@2308  AMT_USER_7      :18.
@2327  AMT_USER_8      :18.
@2346  AMT_USER_9      :18.
@2365  AMT_USER_10     :18.
@2384  DTE_USER_1      :7.
@2392  DTE_USER_2      :7.
@2400  DTE_USER_3      :7.
@2408  DTE_USER_4      :7.
@2416  DTE_USER_5      :7.
@2424  DTE_USER_6      :7.
@2432  DTE_USER_7      :7.
@2440  DTE_USER_8      :7.
@2448  DTE_USER_9      :7.
@2456  DTE_USER_10     :7.
@2464  IND_USER_1      :$2.
@2467  IND_USER_2      :$2.
@2470  IND_USER_3      :$2.
@2473  IND_USER_4      :$2.
@2476  IND_USER_5      :$2.
@2479  IND_USER_6      :$2.
@2482  IND_USER_7      :$2.
@2485  IND_USER_8      :$2.
@2488  IND_USER_9      :$2.
@2491  FLAG_FPD        :$1.
@2493  IND_RESCHEDULE_DEBT     :$2.
@2496  DTE_LAST_MAINT  :7.
@2504  UID_LAST_MAINT  :$3.
@2508  AUTO_SOLD_REPO  :$2.
@2511  EMPLOYER        :$35.
@2547  NATIONALITY     :$3.
@2551  CUST_PROFESSION :$42.
@2594  PHONE_RESERV_1  :$1.
@2596  PHONE_RESERV_2  :$1.
@2598  PHONE_RESERV_3  :$1.
@2600  PHONE_RESERV_4  :$1.
@2602  EMPLOYMENT_STATUS       :$1.
@2604  USER_FILLER     :$133.
@2738  HI_ISO_LANG_CODE        :$3.
@2742  HI_IND_EXCLUSION        :$1.
@2744  FILLER_1        :$1604.
@4349  HI_REPAYMENT_ACCT_NUM   :$19.
@4369  HI_OUTSTANDING_BAL      :18.
@4388  HI_OVERDUE_AMT  :18.
@4407  FILLER_2        :$329.
@4737  FILLER_3        :$1.
@4739  FILLER_4        :$3.
@4743  HI_HIST_REAGE_TYPE      :$1.
@4745  HI_NUM_OF_REAGE_X_YRS   :3.
@4749  HI_MNTH_SNC_LST_REAGE   :3.
@4753  HI_HIGHEST_DELQ_LEV     :2.
@4756  HI_LTR_DELV_PREF_FLAG   :$1.
@4758  NEW_RESTRUCTURE_ACCT    :$1.
@4760  SATISFICATION_FLAG      :$1.
@4762  BU_CORPORATE_ID :$10.
@4773  AGED_HISTORY    :$24.
@4798  PMT_PAST_DUE    :18.
@4817  HI_DESC_PRODUCT :$40.
@4858  HI_CHGOFF_STATUS        :1.
@4860  HI_POTEN_CHGOFF_DTE     :7.
@4868  HI_BUS_SECTOR_CODE      :$1.
@4870  NBR_TIMES_IN_COLL       :3.
@4874  PMT_XDAYS_CTR   :$4.
@4879  PMT_30DAYS_CTR  :$4.
@4884  PMT_60DAYS_CTR  :$4.
@4889  PMT_90DAYS_CTR  :$4.
@4894  PMT_120DAYS_CTR :$4.
@4899  PMT_150DAYS_CTR :$4.
@4904  PMT_180DAYS_CTR :$4.
@4909  PMT_210DAYS_CTR :$4.
@4914  HI_DAYS_SINCE_OVLM      :$3.
@4918  BU_FLAG3_1      :$3.
@4922  DATE_LAST_REAGE :7.
@4930  DATE_LAST_RTN_CHECK     :7.
@4938  LAST_CASH_ADV_AMT       :18.
@4957  TYPE_OF_CARD    :4.
@4962  DTE_LAST_EXPIRY :7.
@4970  LAST_DTE_OVLM   :7.
@4978  FIRST_MISS_PMT_DATE     :7.
@4986  LAST_MISS_PMT_DATE      :7.
@4994  BU_DATE_12      :7.
@5002  BU_PERCENT_1    :$9.
@5012  BU_TEXT15_1     :$15.
@5028  MIN_PYMNT_AMT   :18.
@5047  HI_ACH_STMT_BAL :18.
@5066  HI_AMT_INTEREST :18.
@5085  AMT_LATE_CHARGES        :18.
@5104  YTD_OVLM_CHG    :18.
@5123  AMT_YTD_MEMB_FEES       :18.
@5142  CARD_FEE_DUE_DTE        :$7.
@5150  AMT_LAST_YTD_INT        :7.
@5158  PRIM_CARD_NBR   :$19.
@5178  DDA_ACCT_NBR    :$19.
@5198  DIRECT_DEBIT_FLAG       :$1.
@5200  CHGOFF_RSN      :$2.
@5203  DATE_INTO_COLL  :7.
@5211  NBR_NSF :5.
@5217  CTA_ORG :3.
@5221  MONTHS_OPEN     :3.
@5225  OVERLIMIT_PCT   :3.
@5229  CUST_LEVEL_CREDIT_LIMIT :18.
@5248  CUST_LVL_OUTSTNDNG_AMT  :18.
@5267  CUST_LVL_OVRLMT_AMT     :18.
@5286  USER_CODE_25    :$2.
@5289  USER_CODE_START_DATE    :7.
@5297  USER_CODE_END_DATE      :7.
@5305  BAD_AND_DOUBT_STATUS    :1.
@5307  DATE_LAST_MAINT :7.
@5315  OPEN_TO_BUY     :18.
@5334  INSURANCE_SW    :$1.
@5336  CASH_BALANCE    :18.
@5355  CASH_CRLIM      :18.
@5374  CASH_AVAIL_CREDIT       :18.
@5393  LOAN_CRLIM      :18.
@5412  LOAN_AVAIL      :18.
@5431  LOAN_BALANCE    :18.
@5450  FIRST_DTE_OVLM  :7.
@5458  TOT_LOYALTY_POINTS      :9.
@5468  NATIONAL_ID     :$30.
@5499  PC_CUST_MAT_NAME        :$40.
@5540  STATEMENT_FLAG  :$1.
@5542  LAST_NSF_DATE   :7.
@5550  ACCOUNT_TYPE    :$3.
@5554  ACCT_AGE_IN_MONTHS      :$3.
@5558  VIP_STATUS      :1.
@5560  INT_STATUS      :$1.
@5562  DATE_LAST_STAT_CHG      :7.
@5570  PC_NBR_OF_CARDS :$3.
@5574  SSN_INDICATOR   :1.
@5576  BUSINESS_ADD1   :$40.
@5617  BUSINESS_ADD2   :$40.
@5658  MARITAL_STATUS  :$1.
@5660  GENDER  :$1.
@5662  EMPLOYEE_CODE   :$2.
@5665  INCOME  :18.
@5684  EMERGENCY_CONT_NAME     :$20.
@5705  EMERGENCY_CONT_PHONE    :$20.
@5726  EMERGENCY_CONT_ADDRESS  :$40.
@5767  EMERG_CONT_ADDR_2       :$40.
@5808  EMERG_CONT_ADDR_CITY    :$20.
@5829  EMERG_CONT_ADDR_CNTY    :$2.
@5832  CARD_STATUS     :$1.
@5834  CREDIT_GRADE    :$2.
@5837  OVERLIMIT_FLAG  :$1.
@5839  CHGOFF_STATUS   :$1.
@5841  TRIAD_COLL_IND  :$3.
@5845  CREDIT_SCORE    :$5.
@5851  NBR_PAY_SINCE_ENTRY     :3.
@5855  PRIOR_CREDIT_LIMIT      :18.
@5874  FEE_CHG_PORTION :18.
@5893  ORIG_INSTAL_AMT :18.
@5912  DATE_ACCT_CLOSED        :7.
@5920  CURR_BAD_DEBT_DATE      :7.
@5928  LAST_DELQ_DATE  :7.
@5936  PRESENT_BALANCE_AMT     :18.
@5955  ACH_ACCT_NBR    :$19.
@5975  CR_CLASS        :$2.
@5978  HI_BU_FILLER    :$94.
@6073  CUST_FULL_NAME  :$90.
@6164  HI_REGN_FILLER  :$10.
;
 
 
run;
 
 
%end;
 
%else %do;
        %put ******Files does not exist, non batch day...continuing batch....copying previous day file****** ;
        data stgn.GCMMP;
        set stg.GCMMP;
        run;
%end;
 
%mend;
 
%Extract_src;
 
data c9mart.GCMMP;
set stgn.GCMMP;
run;
 
data &ctry._ANA.GCMMP ;
set stgn.GCMMP (keep= IND_USER: account_nbr CUSTOMER_NBR COLL_ORG ORGANIZATION) ;
run;
 
 
